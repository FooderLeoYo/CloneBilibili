# 项目中碰到的问题

## 目录

[路由跳转和链接跳转](#jump1)

[路由跳转时Channel设置了isDataOk仍然报错](#jump2)

[VideoPage底部切换](#jump3)

[“加载中”过场](#jump4)

[路由跳转和常规跳转后的数据获取方式区别](#jump5)

[VideoPage推荐视频点击无效](#jump6)

[](#jump)

[](#jump)

[](#jump)

---	

<span id="jump1"></span>

## 路由跳转和链接跳转

### 问题

从Ranking点进VideoPage后按返回会发现tab没有当前actived项，继续按返回则页面空白并报错

### 原理分析

一开始从Channel进入Ranking是采用的router跳转

而进入VideoPage采用的是传统跳转方式，所以进入后页面会发生刷新

之前页面的tabbar的当前index信息丢失，所以再返回Ranking时，组件需要这些信息，却只找到undefined，就报错并卡断组件渲染了

### 解决方案

将进入VideoPage的跳转方式改为路由跳转

然而出现新的报错

### 新问题的分析

根据报错信息，是找不到video的相关数据

验证数据获取无问题后，分析报错应该是由于数据量较大，而还未完全获取时组件即使用数据的相关属性

### 尝试解决方案1

尝试使用Concurrent Mode

但是使用后发现终端报提示，该模式目前尚不支持ssr

### 尝试解决方案2

将VideoPage之前的页面，即Ranking、Channel的跳转方式改为传统跳转

但这样每次跳转都会引发页面级重载，页面加载时间长影响用户体验，且消耗性能

### 解决方案3

VideoPage.tsx改为条件渲染

state中即增加一个判断标志默认值为false

return中，添加条件渲染

一开始，判断标志为false时，渲染“加载中”内容

当数据获取完成后将其setState为true，state状态更新引发重新渲染，条件渲染加载真正的内容

这样组件就不会在数据尚未加载成功时，使用数据的相关属性

---	

<span id="jump2"></span>

## 路由跳转时Channel设置了isDataOk仍然报错

### 原因分析

return中用的tabbar数据，是render中生成的变量

而dispatch数据，并将isDataOk由false设置为true是在componentDidMount中

渲染时先执行render中的变量赋值，而此时还未执行componentDidMount，发现无数据，报错

### 解决方案

将tabbar所需的数据变量的赋值，抽取到render之外

---	

<span id="jump3"></span>

## VideoPage底部切换

### 困难1：手指滑动切换效果

#### 解决方案

借鉴轮播图的思路

1. 将推荐和评论部分设置为:

```
float: left
```

并给定宽度：

```
width: 100vw
```

推荐部分需要隐藏水平方向溢出：

```
overflow-x: hidden;
```

2. 外层套一个bottomWrapper，宽度设置为推荐和评论部分的宽度之和，并添加过渡时间：

```
width: 200vw
transition: .5s
```

3. 再外层再套一个bottomArea，设置：

```
overflow: hidden;
```

### 困难2：推荐、评论两边长度不等时，短的一边拉到底是空白

#### 产生原因

推荐、评论设置浮动后，bottomWrapper塌陷

但bottomArea设置了```overflow: hidden;```，bottomArea将不会发生塌陷而是被撑开

因此推荐、评论两者中长的将把另外一边的盒子也撑开，形成空白区域

#### 解决方案

待解决

---	

<span id="jump4"></span>

## “加载中”过场

### 问题：加载动画会发生位移

#### 分析

先加载动画，再加载css，导致样式一开始没应用

#### 解决方案

在css的background-image中引入加载中图片，而不是jsx中的一个img元素

这样就保证了css与图片同时加载

---	

<span id="jump5"></span>

## 路由跳转和常规跳转后的数据获取方式区别

### 先dispatch到store再从props中拿 VS 将获取数据的方法添加到组件自身

详见UpUser.tsx中的componentDidMount

---	

<span id="jump6"></span>

## VideoPage推荐视频点击无效

### 问题

推荐视频点击后路径发生改变，但页面并未跳转到新路径

### 分析

### 解决方案